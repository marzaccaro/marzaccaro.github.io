<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Aliasing | Food For Data</title>
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="Aliasing" />
<meta name="author" content="Martina Z" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Reading Time: 2 minutes" />
<meta property="og:description" content="Reading Time: 2 minutes" />
<link rel="canonical" href="https://marzaccaro.github.io/blog/2020/08/24/aliasing/" />
<meta property="og:url" content="https://marzaccaro.github.io/blog/2020/08/24/aliasing/" />
<meta property="og:site_name" content="Food For Data" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-08-24T18:53:50+01:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Aliasing" />
<script type="application/ld+json">
{"description":"Reading Time: 2 minutes","mainEntityOfPage":{"@type":"WebPage","@id":"https://marzaccaro.github.io/blog/2020/08/24/aliasing/"},"@type":"BlogPosting","url":"https://marzaccaro.github.io/blog/2020/08/24/aliasing/","author":{"@type":"Person","name":"Martina Z"},"headline":"Aliasing","dateModified":"2020-08-24T18:53:50+01:00","datePublished":"2020-08-24T18:53:50+01:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/blog/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://marzaccaro.github.io/blog/feed.xml" title="Food For Data" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/blog/">Food For Data</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/blog/about.html">About</a><a class="page-link" href="/blog/privacy-policy.html">Privacy Policy</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Aliasing</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2020-08-24T18:53:50+01:00" itemprop="datePublished">Aug 24, 2020
      </time>• <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">Martina Z</span></span></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p><span class="rt-reading-time" style="display: block;"><span class="rt-label rt-prefix">Reading Time: </span> <span class="rt-time">2</span> <span class="rt-label rt-postfix">minutes</span></span></p>

<p>I’ll be starting a series of posts about some cool <a rel="noreferrer noopener" href="https://www.snowflake.com/" target="_blank">Snowflake</a> (The cloud data platform) features, that makes SnowSQL really cool – compared to other SQL dialect (I am most familiar with Microsoft SQL Server or T-SQL).</p>

<p>I’ll start the series, talking about <strong>aliasing</strong>.</p>

<p>Sometimes our SQL get really complex: who haven’t seen a nested case statement grows exponentially? so much that after a while you can’t understand anymore if the output is what is supposed to be, and same for window functions.</p>

<p>The suggestion when complexity arise is usually “break down the problem in smaller steps”, and that’s where aliasing can help the most writing your SQL queries.</p>

<p>Snowflake features of aliasing allows you to re-use the same SQL block in another column definition and simplify massively your code, making it more understandable.</p>

<p>For example you might have a SQL like this:</p>

<pre class="EnlighterJSRAW" data-enlighter-language="sql" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">select 
  case 
    when price &gt; 100 and referral_code  = 'XXX1' then price * 0.9
    when referral_code = 'XX2' then price*0.75
    when referral_code = 'XX3' then price - 10 
    else price end as discounted_price,
  case 
    when partner = 'A' then discounted_price*0.2
    when partner = 'B' then discounted_price*0.3
    else discounted_price end as partner_fee
from my_table</pre>

<p>So this is the new alternative, without the aliasing capability (for example in a database like SQL Server, you would have to explicitly re-write the logic for the <code class="language-plaintext highlighter-rouge">discounted_price</code> twice (not DRY, <a rel="noreferrer noopener" href="https://en.wikipedia.org/wiki/Don%27t_repeat_yourself" target="_blank">Don’t Repeat Yourself</a>) or create a function in the database (<a rel="noreferrer noopener" href="https://docs.microsoft.com/en-us/sql/t-sql/statements/create-function-transact-sql?view=sql-server-ver15" target="_blank">like this</a>). So much neater using the alias!</p>

<p>Moreover you can use those aliases in the <code class="language-plaintext highlighter-rouge">where</code>, <code class="language-plaintext highlighter-rouge">group by</code>, <code class="language-plaintext highlighter-rouge">having</code>, <code class="language-plaintext highlighter-rouge">qualify</code> and <code class="language-plaintext highlighter-rouge">order by</code> statement, saving you from copying the same logic multiple times in your query.</p>

<p>Here is another example:</p>

<pre class="EnlighterJSRAW" data-enlighter-language="sql" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">select 
  first_name,
  last_name,
  first_name || ' ' || last_name as full_name
from names
where full_name = 'My Full Name'</pre>

<p>In general this feature is amazing, but there are a couple cases where it might trick you. In particular: alias don’t override existing columns names and can have unexpected behaviour when used in join clauses.</p>

<h5 id="alias-conflicting-with-existing-columns-names">Alias conflicting with existing columns names</h5>

<p>Snowflake doesn’t infer the alias if you create an alias that is already a columns in one of the tables you join. Suppose the tables look like these:</p>

<p>first table t1:<figure class="wp-block-table is-style-regular"></figure></p>

<table>
  <thead>
    <tr>
      <th>id</th>
      <th>email_address</th>
      <th> </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>12</td>
      <td>foo@com</td>
      <td> </td>
    </tr>
    <tr>
      <td>13</td>
      <td>hola@com</td>
      <td>&lt;/figure&gt;</td>
    </tr>
  </tbody>
</table>

<p>second table t2:<figure class="wp-block-table"></figure></p>

<table>
  <thead>
    <tr>
      <th>my_id</th>
      <th>email_address</th>
      <th> </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>12</td>
      <td>food@com</td>
      <td>&lt;/figure&gt;</td>
    </tr>
  </tbody>
</table>

<p>The following query</p>

<pre class="EnlighterJSRAW" data-enlighter-language="sql" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">select 
  t1.id
  , coalesce( t2.email_address, t1.email_address) as email_address
from t1
left join t2
  on t1.id = t2.my_id
where email_address = 'foo@com'</pre>

<p>will give you an error of ambiguous column name, so you’ll need to specify the table for the column you want to use or rename the column alias to be something different from the column names already existing in your tables.</p>

<h5 id="alias-used-in-joins">Alias used in joins.</h5>

<p>Snowflake doesn’t like aliases in joins, suppose we have two tables above, and say you want to rename the <code class="language-plaintext highlighter-rouge">my_id</code> of the second table to <code class="language-plaintext highlighter-rouge">new_id</code> :</p>

<pre class="EnlighterJSRAW" data-enlighter-language="sql" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">select 
  t1.id
  ,t2.my_id as new_id
from t1
left join t2 
  on t1.id = t2.new_id</pre>

<p>Will give you an error of unknown column names, so careful when using aliases in the join.</p>

<p>To summarise, aliases are amazing to simplify your code and stay DRY but needs to be used with care when joining tables.</p>

<p>Hope you too loves aliases, or start using them after reading this post! Did you find any other troubles using them? Let me know.</p>

  </div><a class="u-url" href="/blog/2020/08/24/aliasing/" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/blog/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Food For Data</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Food For Data</li><li><a class="u-email" href="mailto:your-email@example.com">your-email@example.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/marzaccaro"><svg class="svg-icon"><use xlink:href="/blog/assets/minima-social-icons.svg#github"></use></svg> <span class="username">marzaccaro</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Feeding my data thoughts</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
